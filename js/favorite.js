var fav_heroes, fav_list = window.localStorage.getItem("fav_hero_list"), no_fav = document.getElementById("no-fav"), character_display = document.getElementById("display_characters"); function getData(b) { return new Promise((c, a) => { fetch(b).then(a => a.json()).then(a => { c(a) }).catch(b => { a(b) }) }) } function loadCharacters(b) { let c = []; b.forEach(a => { if ("" != a) { c.push(getData(`https://api.allorigins.win/get?url=https://superheroapi.com/api/4301778239934401/${a}`)) } }), Promise.all(c).then(a => { displayFavHeroes(a) }) } function displayFavHeroes(b) { var c; no_fav.style.display = "none"; var d = []; b.forEach(b => { var c = JSON.parse(b.contents); d.push(`<li class="hero-list-item flex" id="${c.id}"><div class="list-item-img" alt="${c.name}"><a href="./hero.html#${c.id}"><img src="${c.image.url}"></a></div><div class="detail-container valign flex space-between"><div class="list-item-details"<p class="list-item-hero-name">${c.name}</p><p class="list-item-hero-real-name">${c.biography["full-name"]}</p></div><div class="add-favorite"><img src="./images/delete_black_24dp.svg" class="delete-btn" alt="delete favorite"></div></div><div class="show_details flex halign"><a href="./hero.html#${c.id}"> Show details -></a></div></li>`) }), c = d.join(""), character_display.innerHTML = c, loadEventListeners() } function loadEventListeners() { document.querySelectorAll(".delete-btn").forEach(a => { a.addEventListener("click", b => { b.stopPropagation(); var c = b.target.parentNode.parentNode.parentNode.getAttribute("id"); const a = fav_heroes.indexOf(c); if (-1 < a) { if (fav_heroes.splice(a, 1), document.getElementById(c).remove(), 0 == fav_heroes.length) no_fav.style.display = "block"; else if (1 == fav_heroes.length) { var d = fav_heroes[0]; "" == d && (no_fav.style.display = "block") } window.localStorage.setItem("fav_hero_list", fav_heroes) } }) }) } null == fav_list ? no_fav.style.display = "block" : (fav_heroes = fav_list.split(","), fav_heroes = [...new Set(fav_heroes)]), null == fav_list || 0 == fav_list.length ? no_fav.style.display = "block" : (no_fav.style.display = "none", loadCharacters(fav_heroes));