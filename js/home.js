var searchBar = document.getElementById("searchBar"), clearBtn = document.getElementById("clear"), message = document.getElementById("not-found"), characterList = document.getElementById("characterList"); let heroCharacters = []; var characters; let favoriteHeroString = window.localStorage.getItem("fav_hero_list"); var favoriteHero; favoriteHero = null === favoriteHeroString ? [] : favoriteHeroString.split(","); var controller = new AbortController; function displayNotFound() { characterList.innerHTML = "", message.style.display = "block" } function displayCharacters(e) { message.style.display = "none"; var t = [], a = window.localStorage.getItem("fav_hero_list"); a = null != a ? a.split(",") : [], e.forEach(function (e) { var r; void 0 !== a.find(t => t == e.id) ? (r = `<li class="hero-list-item flex" id="${e.id}"><div class="list-item-img"><a href="./hero.html#${e.id}"><img src="${e.image.url}" alt="${e.name}"></a></div><div class="detail-container valign flex space-between"><div class="list-item-details"><p class="list-item-hero-name">${e.name}</p><p class="list-item-hero-real-name">${e.biography["full-name"]}</p></div><div class="add-favorite"><img src="./images/299063_heart_icon.svg" class="like-btn" alt="add favorite"></div></div><div class="show_details flex halign"><a href="./hero.html#${e.id}"> Show details -></a></div></li>`, t.push(r)) : (r = `<li class="hero-list-item flex" id="${e.id}"><div class="list-item-img"><a href="./hero.html#${e.id}"><img src="${e.image.url}" alt="${e.name}"></a></div><div class="detail-container valign flex space-between"><div class="list-item-details"><p class="list-item-hero-name">${e.name}</p><p class="list-item-hero-real-name">${e.biography["full-name"]}</p></div><div class="add-favorite"><img src="./images/favorite_border_black_24dp.svg" class="like-btn" alt="add favorite"></div></div><div class="show_details flex halign"><a href="./hero.html#${e.id}"> Show details -></a></div></li>`, t.push(r)) }); var r = t.join(""); characterList.innerHTML = r } searchBar.addEventListener("input", function () { "" != this.value ? clearBtn.style.display = "block" : clearBtn.style.display = "none" }), searchBar.addEventListener("keyup", e => { const t = e.target.value; controller.abort(), controller = new AbortController, "" == t ? (clearBtn.style.display = "none", characterList.innerHTML = "") : loadCharacters(t).then(e => { "error" == (characters = JSON.parse(e.contents)).response ? displayNotFound() : (displayCharacters(heroCharacters = characters.results), document.querySelectorAll(".like-btn").forEach(e => { e.addEventListener("click", e => { e.stopPropagation(); var t = e.target, a = t.parentNode.parentNode.parentNode.getAttribute("id"); if ("./images/favorite_border_black_24dp.svg" == t.getAttribute("src")) t.setAttribute("src", "./images/299063_heart_icon.svg"), favoriteHero.push(a), window.localStorage.setItem("fav_hero_list", favoriteHero); else { t.setAttribute("src", "./images/favorite_border_black_24dp.svg"); const e = favoriteHero.indexOf(a); e > -1 && favoriteHero.splice(e, 1), window.localStorage.setItem("fav_hero_list", favoriteHero) } }) })) }).catch(e => { displayNotFound() }) }), clearBtn.addEventListener("click", function () { searchBar.value = "", clearBtn.style.display = "none", searchBar.focus(), characterList.innerHTML = "" }); const loadCharacters = e => { return getHeroData(`https://api.allorigins.win/get?url=https://superheroapi.com/api/4301778239934401/search/${e}`).then(e => e).catch(e => { console.log("Character not found") }) }; function getHeroData(e) { return new Promise((t, a) => { fetch(e).then(e => e.json()).then(e => { t(e) }).catch(e => { a(e) }) }) }